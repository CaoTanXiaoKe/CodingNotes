## 文件和目录

#### 文件系统的基本结构

分区：
i表|数据块|目录块|数据块|目录块|数据块|...|
-------------------------------------------

目录块的内容：
i节点编号|文件名|
-----------------

i 节点包含了所有与文件有关的信息：文件类型，文件存取许可权位，文件长度，文件时间信息和指向文件所占用的数据块的指针等等。 stat结构中的大多数信息都取自 i 节点。只有两项数据存放在目录项中：**文件名**和**i节点编号**。 

**ls -l** 能显示大部分的关于文件的信息。 

#### 对Linux/Unix中一些规则的解读

- 在不更改文件系统的情况下为一个文件更名时，该文件的实际内容并未移动，只需构造一个指向现存i节点的新目录项，并删除老的目录项。mv(1)命令的通常操作方式。

- 硬链接是建立了一个目录块，指向目标文件的i节点，导致目标文件的**i节点中的计数加一**，而且只有该计数减为0时，并且当前系统中没有进程对该文件进行访问，才会删除该文件（或目录）。 符号链接本身是一个文本文件，文件中记录着它指向的目标文件的地址（文件路径）。

- 由于硬链接需要填写目录块中的 i 节点编号，而不同文件系统 i 节点编号不同，因此硬链接不能跨文件系统，而符号链接则没有这个限制。 

- 由于指向文件目录的硬链接，所造成的循环很难打破，因为unlink函数会跟随硬链接，但是unlink函数不跟随符号链接，所以符号链接造成的循环很好打破。 因此操作系统只允许超级用户在文件目录上建硬链接。

#### 文件的时间
字段| 说 明 | 例子 | ls(1)选项|
----|-------|------|-----------
st_atime | 文件数据的最后访问时间 | read | -u
st_mtime | 文件数据的最后修改时间 | write | 缺省
st_ctime | i节点状态的最后更改时间 | chmod, chown | -c

使用 `find` 命令，根据这三种文件的时间属性，通常可以对文件进行一些删除，备份，归档操作。
例如删除当前目录下，最近一周都未访问的文件：
`find . -f -atime`

#### 目录

对于某个目录具有访问权限的任一用户都可以读该目录，但是，为了防止文件系统产生混乱，只有内核才能写目录。 一个目录的写许可权位和执行许可权位，决定了在该目录中能否创建新文件以及删除文件，它们并不表示能否写目录本身。 

如果要更改目录本身，则需要对该目录所在的父目录具有写和执行权限。 

- 函数 sync 只是将所有修改过的块的缓存排入写队列，然后就返回，它并不等待实际I/O操作结束。（命令sync 调用了 sync函数，所以效果一样）。 
- 函数 fsync 只引用单个文件，它等待I/O结束，然后返回。 fsync 可用于数据库这样的应用程序，它确保修改过的块立即写到磁盘上。
